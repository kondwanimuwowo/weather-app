(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();async function l(e,t){try{typeof t=="object"&&(t=JSON.stringify(t)),localStorage.setItem(e,t),console.log(`Stored ${e} in localStorage`)}catch(o){throw console.error(`Failed to store ${e} in localStorage:`,o.message),new Error(`Failed to store ${e} in localStorage`)}}async function c(e){try{const t=localStorage.getItem(e);if(t===null)return console.warn(`No value found for key: ${e}`),null;try{return JSON.parse(t)}catch{return t}}catch(t){throw console.error(`Failed to retrieve ${e} from localStorage:`,t.message),new Error(`Failed to retrieve ${e} from localStorage`)}}function d(){console.log("getCity called");const e=c("lastCity"),t=document.querySelector("#city-input");return(t==null?void 0:t.value.trim())||e||"Lusaka"}async function u(e,t){S(),console.log("renderWeatherData called with city:",e,"and unitGroup:",t);const o={cityName:document.querySelector("#city-name"),temperature:document.querySelector("#temperature"),humidity:document.querySelector("#humidity"),windspeed:document.querySelector("#wind"),conditions:document.querySelector("#condition"),weatherIcon:document.querySelector(".icon i")};f();try{const r=await q(e);if(console.log("Weather data received:",r),!r||!r.currentConditions)throw new Error("Invalid weather data received");console.log("Rendering weather data for city:",e,"with unit group:",t),o.cityName.textContent=r.address,o.temperature.textContent=`${r.currentTemp}Â°${t==="metric"?"C":"F"}`,o.humidity.textContent=`${r.currentHumidity}%`,o.windspeed.textContent=`${r.currentWindspeed} ${t==="metric"?"km/h":"mph"}`,o.conditions.textContent=r.currentConditions,o.weatherIcon.className=p(r.weatherIcon)}catch(r){console.error("Error rendering weather data:",r.message),i("City not found. Try again with a valid city Name.")}finally{C()}}function p(e){if(!e||typeof e!="string")return console.warn(`Invalid condition: ${e}`),"fas fa-question";const t=e.toLowerCase();return{"clear-day":"fas fa-sun","clear-night":"fas fa-moon","partly-cloudy-day":"fas fa-cloud-sun",cloudy:"fas fa-cloud",rain:"fas fa-cloud-rain",snow:"fas fa-snowflake",fog:"fas fa-smog",overcast:"fas fa-cloud"}[t]??"fas fa-question"}function i(e){const t=document.querySelector("#error-message");t?(t.textContent=e,t.style.display="block"):console.error("Error message element not found in the DOM.")}function f(){const e=document.querySelector("#error-message");e?(e.textContent="",e.style.display="none"):console.warn("Error message element not found in the DOM.")}function S(){const e=document.querySelector("#loading");e&&(e.style.display="block"),document.querySelector("main").setAttribute("aria-busy","true")}function C(){const e=document.querySelector("#loading");e&&(e.style.display="none"),document.querySelector("main").setAttribute("aria-busy","false")}const v="4FQFL9F4H4WSSKTPHAZV3L2AC",$="https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/";async function E(e=d(),t,o){console.log("Fetching weather data for city:",e,"with range:",t,"and unit group:",o);try{const r=await fetch(`${$}${encodeURIComponent(e)}/${t}?unitGroup=${o}&key=${v}&contentType=json`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Failed to fetch weather data:",r.message),i("Failed to fetch weather data: "+r.message),r}}async function q(e=d(),t="today",o){if(o=o||await c("unitGroup")||"metric",console.log("getWeather called with city:",e,"and unitGroup:",o),!(e!=null&&e.trim())||typeof e!="string")throw new Error("City name must be a non-empty string");const r=`${e}_${o}`,n=await c(r);if(n&&Date.now()-n.timestamp<10*60*1e3)return console.log("Using cached data for",r),console.log("Cached data:",n.data),await l("lastCity",e),n.data;console.log("No valid cache found for",r,", fetching new data.");try{const a=await E(e,t,o);if(!(a!=null&&a.currentConditions))throw new Error("Invalid weather data received");await l("lastCity",e);const{resolvedAddress:s,currentConditions:{temp:h=0,windspeed:g=0,conditions:y="",humidity:m=0,icon:w=""}}=a;return console.log("Data Fetched",{currentTemp:h,currentHumidity:m,currentWindspeed:g,currentConditions:y,weatherIcon:w}),await l(r,{timestamp:Date.now(),data:{currentTemp:h,currentHumidity:m,currentWindspeed:g,currentConditions:y,weatherIcon:w,address:s}}),{currentTemp:h,currentHumidity:m,currentWindspeed:g,currentConditions:y,weatherIcon:w,address:s}}catch(a){throw console.error("Error fetching weather data:",a.message),i("Failed to get the weather data: "+a.message),a}}async function L(){console.log("Initializing App...");const e=await c("lastCity")||"Lusaka",t=await c("unitGroup")||"metric";F(),u(e,t),b()}async function F(){const e=document.querySelector("#search-btn"),t=document.querySelector("#city-input");e.addEventListener("click",async()=>{f();try{const o=d(),r=await c("unitGroup")||"metric";o&&(console.log(`Searching for city: ${o}`),await u(o,r)),t.value=""}catch(o){console.error("Error during search:",o),i("Failed to search for city: "+o)}}),t.addEventListener("keypress",async o=>{if(o.key==="Enter"){o.preventDefault(),f();try{const r=d();r&&(console.log(`Searching for city: ${r}`),await u(r)),t.value=""}catch(r){console.error("Error during search:",r),i("Failed to search for city: "+r)}}}),console.log("Search handler active")}async function b(){try{const e=document.querySelector("#unit-switch"),t=await c("unitGroup");e.checked=t==="us",e.addEventListener("change",async()=>{f(),console.log("Unit switch changed:",e.checked?"US":"Metric");const o=await c("lastCity")||"Lusaka",r=e.checked?"us":"metric";await l("unitGroup",r),u(o,r),console.log(`Unit group set to: ${r}`)})}catch(e){console.error("Error in handleUnitToggling:",e),i("Failed to toggle unit group: "+e)}console.log("toggle handler active")}async function I(){try{await L()}catch(e){console.error("Failed to start app:",e.message);const t=document.querySelector("#error-message");t&&(t.textContent="Failed to initialize app. Please try again.",t.style.display="block")}}I();window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason);const t=document.querySelector("#error-message");t&&(t.textContent="An unexpected error occurred.",t.style.display="block")});
