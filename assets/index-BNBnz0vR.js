(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const a of n)if(a.type==="childList")for(const s of a.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function o(n){const a={};return n.integrity&&(a.integrity=n.integrity),n.referrerPolicy&&(a.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?a.credentials="include":n.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(n){if(n.ep)return;n.ep=!0;const a=o(n);fetch(n.href,a)}})();async function d(e,t){try{typeof t=="object"&&(t=JSON.stringify(t)),localStorage.setItem(e,t)}catch(o){throw console.error(`Failed to store ${e} in localStorage:`,o.message),new Error(`Failed to store ${e} in localStorage`)}}async function c(e){try{const t=localStorage.getItem(e);if(t===null)return null;try{return JSON.parse(t)}catch{return t}}catch(t){throw console.error(`Failed to retrieve ${e} from localStorage:`,t.message),new Error(`Failed to retrieve ${e} from localStorage`)}}function u(){const e=c("lastCity"),t=document.querySelector("#city-input");return(t==null?void 0:t.value.trim())||e||"Lusaka"}async function l(e,t){S();const o={cityName:document.querySelector("#city-name"),temperature:document.querySelector("#temperature"),humidity:document.querySelector("#humidity"),windspeed:document.querySelector("#wind"),conditions:document.querySelector("#condition"),weatherIcon:document.querySelector(".icon i")};f();try{const r=await L(e);if(!r||!r.currentConditions)throw new Error("Invalid weather data received");o.cityName.textContent=r.address,o.temperature.textContent=`${r.currentTemp}Â°${t==="metric"?"C":"F"}`,o.humidity.textContent=`${r.currentHumidity}%`,o.windspeed.textContent=`${r.currentWindspeed} ${t==="metric"?"km/h":"mph"}`,o.conditions.textContent=r.currentConditions,o.weatherIcon.className=w(r.weatherIcon)}catch(r){console.error("Error rendering weather data:",r.message),i("City not found. Try again with a valid city Name.")}finally{C()}}function w(e){if(!e||typeof e!="string")return console.warn(`Invalid condition: ${e}`),"fas fa-question";const t=e.toLowerCase();return{"clear-day":"fas fa-sun","clear-night":"fas fa-moon","partly-cloudy-day":"fas fa-cloud-sun",cloudy:"fas fa-cloud",rain:"fas fa-cloud-rain",snow:"fas fa-snowflake",fog:"fas fa-smog",overcast:"fas fa-cloud"}[t]??"fas fa-question"}function i(e){const t=document.querySelector("#error-message");t?(t.textContent=e,t.style.display="block"):console.error("Error message element not found in the DOM.")}function f(){const e=document.querySelector("#error-message");e?(e.textContent="",e.style.display="none"):console.warn("Error message element not found in the DOM.")}function S(){const e=document.querySelector("#loading");e&&(e.style.display="block"),document.querySelector("main").setAttribute("aria-busy","true")}function C(){const e=document.querySelector("#loading");e&&(e.style.display="none"),document.querySelector("main").setAttribute("aria-busy","false")}const E="4FQFL9F4H4WSSKTPHAZV3L2AC",v="https://weather.visualcrossing.com/VisualCrossingWebServices/rest/services/timeline/";async function q(e=u(),t,o){try{const r=await fetch(`${v}${encodeURIComponent(e)}/${t}?unitGroup=${o}&key=${E}&contentType=json`);if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);return await r.json()}catch(r){throw console.error("Failed to fetch weather data:",r.message),i("Failed to fetch weather data: "+r.message),r}}async function L(e=u(),t="today",o){if(o=o||await c("unitGroup")||"metric",!(e!=null&&e.trim())||typeof e!="string")throw new Error("City name must be a non-empty string");const r=`${e}_${o}`,n=await c(r);if(n&&Date.now()-n.timestamp<10*60*1e3)return await d("lastCity",e),n.data;try{const a=await q(e,t,o);if(!(a!=null&&a.currentConditions))throw new Error("Invalid weather data received");await d("lastCity",e);const{resolvedAddress:s,currentConditions:{temp:y=0,windspeed:m=0,conditions:h="",humidity:g=0,icon:p=""}}=a;return await d(r,{timestamp:Date.now(),data:{currentTemp:y,currentHumidity:g,currentWindspeed:m,currentConditions:h,weatherIcon:p,address:s}}),{currentTemp:y,currentHumidity:g,currentWindspeed:m,currentConditions:h,weatherIcon:p,address:s}}catch(a){throw console.error("Error fetching weather data:",a.message),i("Failed to get the weather data: "+a.message),a}}async function $(){const e=await c("lastCity")||"Lusaka",t=await c("unitGroup")||"metric";F(),l(e,t),b()}async function F(){const e=document.querySelector("#search-btn"),t=document.querySelector("#city-input");e.addEventListener("click",async()=>{f();try{const o=u(),r=await c("unitGroup")||"metric";o&&await l(o,r),t.value=""}catch(o){console.error("Error during search:",o),i("Failed to search for city: "+o)}}),t.addEventListener("keypress",async o=>{if(o.key==="Enter"){o.preventDefault(),f();try{const r=u();r&&await l(r),t.value=""}catch(r){console.error("Error during search:",r),i("Failed to search for city: "+r)}}})}async function b(){try{const e=document.querySelector("#unit-switch"),t=document.querySelector(".toggle-switch .slider"),o=await c("unitGroup");e.checked=o==="us",e.addEventListener("change",async()=>{f();const r=await c("lastCity")||"Lusaka",n=e.checked?"us":"metric";await d("unitGroup",n),l(r,n)}),t.addEventListener("click",()=>{e.checked=!e.checked;const r=new Event("change");e.dispatchEvent(r)})}catch(e){console.error("Error in handleUnitToggling:",e),i("Failed to toggle unit group: "+e)}}async function I(){try{await $()}catch(e){console.error("Failed to start app:",e.message);const t=document.querySelector("#error-message");t&&(t.textContent="Failed to initialize app. Please try again.",t.style.display="block")}}I();window.addEventListener("unhandledrejection",e=>{console.error("Unhandled promise rejection:",e.reason);const t=document.querySelector("#error-message");t&&(t.textContent="An unexpected error occurred.",t.style.display="block")});
